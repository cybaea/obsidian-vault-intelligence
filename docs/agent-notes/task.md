# Task Breakdown

- [x] Planning Advanced Agent Support
    - [x] Create implementation plan
    - [x] Research Nomic/BGE specific configs in Transformers.js
- [x] Phase 1: Settings & UI
    - [x] Create `src/utils/validation.ts`
    - [x] Update `src/services/VectorStore.ts` with `reindexVault` stub
    - [x] Update `VaultIntelligenceSettings` to include model selection enum
    - [x] Refactor `src/settings/sections/models.ts`
    - [x] Implement `validateModel` logic for Custom models
    - [x] Add "Re-download" and "Re-index" buttons
- [x] Phase 2: Worker Upgrades
    - [x] Refactor `embedding.worker.ts` to return `number[][]` (multiple vectors)
    - [x] Implement text chunking logic (inside worker to use tokenizer)
    - [x] Generalize `loadPipeline` for BGE/Nomic support
    - [x] Update `LocalEmbeddingService` to handle multi-vector responses
- [x] Phase 3: Vector Store Refactoring
    - [x] Update `VectorIndex` interface for 1-to-many file mapping
    - [x] Implement `vectorStore.reindexVault()` (wipes data + full scan)
    - [x] Update `upsertVector` to manage ID allocation for chunks
    - [x] Update `deleteVector` to free multiple IDs
    - [x] Add model ID persistence to `index.json`
- [x] Phase 4: Verification & Linting
    - [x] Resolve all 53 lint errors (any types, sentence case, unsafe access)
    - [x] Address feedback on Gemini chunking
    - [x] Resolve build errors (TS2769: BigInt conversion)
    - [x] Fix "Dimension Mismatch" error (Expected 384, got 256)
    - [x] Verify clean build AND clean lint
    - [x] Verify search accuracy (long notes)
- [x] Final Documentation
    - [x] Create walkthrough of verified fix
    - [x] Update docs with new model features
- [x] Post-Release Stability
    - [x] Clarify GeminiService logs (Chat vs Embedding)
    - [x] Enable reactive vault scan on settings change
    - [x] Fixed "Invalid rank" error in worker
    - [x] Fixed startup dimension sanity check
    - [x] Create persistent debug workflow with dynamic port detection
- [x] Performance Optimization
    - [x] Inline dotProduct in VectorStore.ts
    - [x] Optimize vector buffer growth strategy
    - [x] Add diagnostic timing to similarity search
    - [x] Implement Priority Queuing in LocalEmbeddingService
    - [x] Fix live embedding redundancy (Caching)
    - [x] Optimize Local Worker (SIMD + Multi-threading)
    - [x] Implement Platform-Aware Threading (1 thread for Mobile)
    - [x] Verify sub-second search speed during re-indexing
